require 'grpc'
require 'gitaly'

creds = GRPC::Core::ChannelCredentials.new(File.read('gitaly.crt'))
addr = 'localhost:8877'
chan = GRPC::Core::Channel.new(addr, { GRPC::Core::Channel::SSL_TARGET => 'gitaly' }, creds)
stub = Gitaly::Notifications::Stub.new(nil, nil, channel_override: chan)
puts stub.post_receive(Gitaly::PostReceiveRequest.new(repository: Gitaly::Repository.new))
